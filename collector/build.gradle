plugins {
  id 'java-library'
  id 'scala'
  id 'com.github.maiflai.scalatest'
  id 'maven-publish'
  id 'signing'
  id 'com.google.cloud.tools.jib'
  id 'org.podval.tools.cloudrun'
}

description = 'Archive Collector'

configureLibrary()
configureService()

dependencies {
  api project(':opentorah-metadata')
  implementation project(':opentorah-tei')
  implementation project(':opentorah-util')

  implementation "com.vladsch.flexmark:flexmark:$flexmarkVersion"
  implementation "com.vladsch.flexmark:flexmark-ext-toc:$flexmarkVersion"
//  implementation "com.vladsch.flexmark:flexmark-util-ast:$flexmarkVersion"
//  implementation "com.vladsch.flexmark:flexmark-util-data:$flexmarkVersion"

  implementation "ch.qos.logback:logback-classic:$logbackVersion"

  testImplementation "org.podval.tools:org.podval.tools.run:$podvalRunVersion"

  // I didn't find [ScalaCache](https://cb372.github.io/scalacache/) documentation,
  // and since I am not at the point of using anything other than Caffeine,
  // I'll use it directly - albeit not Scala-idiomatically ;)
  implementation "com.github.ben-manes.caffeine:caffeine:$caffeineVersion"
}

jib.from.image = 'gcr.io/distroless/java:11'
jib.container.mainClass = 'org.opentorah.collector.Service'

cloudRun.region = 'us-east4'
deploy.dependsOn(cloudRunDeploy)

cloudRunLocal.additionalOptions = [
  // --volume?
  '--mount', 'type=bind,source=/home/dub/OpenTorah/alter-rebbe.org/,target=/mnt/store/',
  '--env'  , 'STORE=file:///mnt/store/'
]
